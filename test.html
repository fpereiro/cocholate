<!DOCTYPE HTML>
<html>
   <head>
      <meta charset="utf8">
      <title>Cocholate!</title>
   </head>
   <body>
      <script src="node_modules/dale/dale.js"></script>
      <script src="node_modules/teishi/teishi.js"></script>
      <script src="https://cdn.rawgit.com/fpereiro/lith/13a7d1893b29611ee24e2b451148ba266e678249/lith.js"></script>
      <script src="cocholate.js"></script>
      <script>

         var dale   = window.dale;
         var teishi = window.teishi;
         var lith   = window.lith;
         var c      = window.c;

         var type = teishi.t, log = teishi.l;

         var Test = function (fun) {
            var error = fun ();
            if (error) throw new Error (error);
         };

         c.ready (function () {

            Test (function () {
               if (c ('selector', /invalidfun/) !== false) return 'Invalid function was considered valid.';
               if (c ('body').length !== 1)                return 'Find could not locate body.';

               c.fill ('body', lith.g ([
                  ['div', {class: 'hola'}, 'Content'],
                  ['div', {id: 'hola'}, 'Content']
               ]));

               if (c ('.hola') [0].innerHTML !== 'Content')    return 'Class selector didn\'t work.';
               if (c ('#hola').innerHTML     !== 'Content')    return 'Id selector didn\'t work.';
               if (c ('div#hola').innerHTML     !== 'Content') return 'Id selector didn\'t work.';

               if (type (c ('#hola[name="name"]')) !== 'array') return 'Non id selector starting with # didn\'t work.';
               if (type (c ('#hola>div')) !== 'array')          return 'Non id selector starting with # didn\'t work.';

               c.fill ('body', lith.g ([
                  ['div', {id: 'hola'}, [
                     ['p', {class: 'a'}, 'Yes.'],
                     ['p', {class: 'b'}, 'No.'],
                  ]]
               ]));

               if (c ('body').length !== 1)      return 'c.empty didn\'t work.';
               if (c ('body p').length !== 2)    return 'c.fill didn\'t work.';
               if (c ('#hola p.a').length !== 1) return 'Non-id selector with id first element didn\'t work.';

               if (c.fill ('body', /notastring/) !== false) return 'c.fill accepted invalid HTML.';

               if (c (['invalid', 'div']) !== false) return 'invalid array selector was accepted.';

               if (c ([':or', 'div', 'p']).length !== 3) return 'or selector didn\'t work.';

               if (c ([':or', [':or', 'div', 'p']]).length !== 3) return 'nested or selector didn\'t work.';

               if (c ([':and', 'div *', 'p']).length !== 2) return 'and selector didn\'t work.';

               if (c ([':and', 'div', 'p']).length !== 0) return 'and selector didn\'t work.';

               if (c ([':and', [':or', 'div', 'p']]).length !== 3) return 'and selector didn\'t work.';

               if (c ([':not', 'div#hola']).length !== 7) return 'not selector didn\'t work.';
               if (c ([':not', 'body']).length !== 7) return 'not selector didn\'t work.';
               if (c ([':not', 'div#hola', 'body']).length !== 6) return 'not selector didn\'t work.';
               if (c ([':not', 'div#hola *']).length !== 6) return 'not selector didn\'t work.';
               if (c ([':not', 'div', 'p']).length !== 5) return 'not selector didn\'t work.';
               if (c ([':not', [':or', 'div', 'p']]).length !== 5) return 'not selector didn\'t work.';
               if (c ([':and', [':not', 'div#hola'], [':not', 'p']]).length !== 5) return 'not selector didn\'t work.';

               if (c ([':and', 'body *', [':or', 'div', 'p']]).length !== 3) return 'nested selector didn\'t work.';

               c.fill ('body', lith.g ([
                  ['div', {class: 'inner'}],
                  ['div', {id: 'container'}, ['div', {class: 'inner'}]]
               ]));

               if (c ({selector: 'div.inner', from: c ('#container')}).length !== 1) return 'from selector didn\'t work.';

               c.fill ('body', lith.g (['div', {id: 'container'}, ['div', {id: 'inner'}]]));

               c.place ('#container', 'beforeBegin', lith.g (['div', {id: 'beforecontainer'}]));
               if (c ('body div') [0].getAttribute ('id') !== 'beforecontainer') return 'c.place beforeBegin didn\'t work';

               c.place ('#container', 'afterEnd', lith.g (['div', {id: 'aftercontainer'}]));
               if (c ('body div') [c ('body div').length - 1].getAttribute ('id') !== 'aftercontainer') return 'c.place afterEnd didn\'t work';

               c.place ('#container', 'afterBegin', lith.g (['div', {id: 'beforeinner'}]));
               if (c ('#container div') [0].getAttribute ('id') !== 'beforeinner') return 'c.place afterBegin didn\'t work';

               c.place ('#container', 'beforeEnd', lith.g (['div', {id: 'afterinner'}]));
               if (c ('#container div') [2].getAttribute ('id') !== 'afterinner') return 'c.place beforeEnd didn\'t work';

               if (c.set ('#container div', {'^': 'someclass'}) !== false) return 'c.set accepted invalid input';
               c.set ('#container div', {class: 'someclass'});

               if (c ('#container div.someclass').length !== 3) 'c.set didn\'t work.';

               if (c.get ('#container div', 'class') [0].class !== 'someclass') return 'c.get didn\'t work.';

               c.set ('#container div', {width: '200px'}, true);

               if (c.get ('#container div', ['height', 'width'], true) [0].height !== null) return 'multiple c.get didn\'t work.';
               if (c.get ('#container div', ['height', 'width'], true) [0].width  !== '200px') return 'multiple c.get didn\'t work.';

               c.fill ('body', lith.g (dale.do (['red', 'blue', 'green'], function (v, k) {
                  return ['p', {id: 'a' + k, class: v}];
               })));

               if (JSON.stringify (c.get ('p',    ['id', 'class'])) !== '[{"id":"a0","class":"red"},{"id":"a1","class":"blue"},{"id":"a2","class":"green"}]') return 'c.get didn\'t work.';

               if (JSON.stringify (c.get ('#a0', ['id', 'class']))  !== '{"id":"a0","class":"red"}') return 'c.get didn\'t work.';
               if (JSON.stringify (c.get ('p#a0', ['id', 'class'])) !== '{"id":"a0","class":"red"}') return 'c.get didn\'t work.';

               c.fill ('body', lith.g (dale.do (['red', 'blue', 'green'], function (v) {
                  return ['p', {style: 'color: ' + v}];
               })));

               if (JSON.stringify (c.get ('p', 'color', true)) !== '[{"color":"red"},{"color":"blue"},{"color":"green"}]') return 'c.get didn\'t work.';

               c.fill ('body', lith.g (['p']));

               c.set ('body p', {class: 'someclass'});
               if (JSON.stringify (c.get ('body p', 'class')) !== '[{"class":"someclass"}]') return 'c.set didn\'t work.';

               c.set ('body p', {class: null});
               if (JSON.stringify (c.get ('body p', ['class', 'another'])) !== '[{"class":null,"another":null}]') return 'c.set didn\'t work.';

               c.set ('body p', {color: 'red'}, true);
               if (JSON.stringify (c.get ('body p', 'color', true)) !== '[{"color":"red"}]') return 'c.set didn\'t work.';

               c.set ('body p', {color: null}, true);
               if (JSON.stringify (c.get ('body p', 'color', true)) !== '[{"color":null}]') return 'c.set didn\'t work.';

               c.fill ('body', lith.g ([
                  ['input', {id: 'wha', value: 1}],
                  ['input', {id: 'other'}]
               ]));

               var wha;
               var styl;
               c ('#wha').onchange = function () {
                  wha  = this.value;
                  styl = this.style.color;
               }
               c.set ('#wha', {value: 2});
               if (wha !== '2') return 'onchange wasn\'t fired by c.set';
               c.set ('#wha', {color: 'lime'}, true);
               if (styl !== 'lime') return 'onchange wasn\'t fired by c.set';

               c.set ('#wha', {value: 3}, false, true);
               c.set ('#wha', {color: 'magenta'}, true, true);
               if (wha !== '2') return 'onchange wasn\'t detriggered by c.set';
               if (styl !== 'lime') return 'onchange wasn\'t fired by c.set';

               if (c.cookie ('username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 UTC').username !== 'John Doe') return 'c.cookie didn\'t work.';

               if (c.ajax (/invalidmethod/, /invalidpath/) !== false) return 'c.ajax didn\'t validate its input.';

               var error;
               var ajax = c.ajax ('get', 'http://hope.itaint.valid', null, null, function (request) {
                  if (request.status !== 0) throw new Error ('c.ajax did something strange');
                  if (! error) log ('Success', 'All tests were successful!');
                  if (! error) c.fill ('body', lith.g ('All tests were successful!'));
               });

               if (type (ajax) !== 'object' || type (ajax.headers) !== 'object' || type (ajax.body) !== 'string') {
                  error = true;
                  return 'c.ajax didn\'t return a valid object.';
               }

            });
         });

      </script>
   </body>
</html>
